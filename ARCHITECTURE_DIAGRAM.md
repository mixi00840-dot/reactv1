# ğŸ—ï¸ Flutter App Backend Architecture

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FLUTTER APP (Frontend)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          UI LAYER                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   Feed     â”‚  â”‚  Profile   â”‚  â”‚   Shop     â”‚  â”‚  Messages â”‚â”‚
â”‚  â”‚  Screen    â”‚  â”‚  Screen    â”‚  â”‚  Screens   â”‚  â”‚  Screens  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Uses Services
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SERVICE LAYER                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Product    â”‚  â”‚    Cart     â”‚  â”‚    Auth     â”‚  â”‚ Messagesâ”‚â”‚
â”‚  â”‚  Service    â”‚  â”‚   Service   â”‚  â”‚   Service   â”‚  â”‚ Service â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Extends
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CORE LAYER                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              ApiService (Singleton)                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚  GET   â”‚  â”‚  POST  â”‚  â”‚  PUT   â”‚  â”‚    DELETE      â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚     Token Management (SharedPreferences)           â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚     Error Handling (ApiException)                  â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              ApiConfig (Constants)                        â”‚   â”‚
â”‚  â”‚  â€¢ Base URL        â€¢ Endpoints      â€¢ Timeouts           â”‚   â”‚
â”‚  â”‚  â€¢ WebSocket URL   â€¢ Storage Keys   â€¢ Defaults           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTP / WebSocket
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NETWORK LAYER                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   HTTP Client    â”‚          â”‚   WebSocket Channel        â”‚   â”‚
â”‚  â”‚  (http package)  â”‚          â”‚  (web_socket_channel)      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ REST API / WebSocket Protocol
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   BACKEND SERVER (Node.js + MongoDB)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Products  â”‚  â”‚    Cart    â”‚  â”‚    Auth    â”‚  â”‚  Messages â”‚â”‚
â”‚  â”‚    API     â”‚  â”‚    API     â”‚  â”‚    API     â”‚  â”‚    API    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   MongoDB Database                        â”‚   â”‚
â”‚  â”‚  â€¢ Users   â€¢ Products   â€¢ Cart   â€¢ Orders   â€¢ Messages   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

### HTTP Request Flow (REST API)
```
UI Screen
   â”‚
   â”œâ”€â†’ Call Service Method (e.g., ProductService.getProducts())
   â”‚
   â””â”€â†’ Service calls ApiService.get()
       â”‚
       â”œâ”€â†’ ApiService adds auth token from SharedPreferences
       â”‚
       â”œâ”€â†’ ApiService builds headers (Content-Type, Authorization)
       â”‚
       â”œâ”€â†’ HTTP Client sends request to Backend API
       â”‚
       â””â”€â†’ Response received
           â”‚
           â”œâ”€â†’ Success (200-299): Parse JSON and return data
           â”‚
           â”œâ”€â†’ Unauthorized (401): Clear token, throw ApiException
           â”‚
           â”œâ”€â†’ Not Found (404): Throw ApiException with 404
           â”‚
           â””â”€â†’ Error: Throw ApiException with error message
```

### WebSocket Flow (Real-time)
```
ChatScreen
   â”‚
   â”œâ”€â†’ Call MessagesService.connectWebSocket(token)
   â”‚
   â””â”€â†’ MessagesService creates WebSocketChannel
       â”‚
       â”œâ”€â†’ Connect to wss://backend-url?token=xyz
       â”‚
       â”œâ”€â†’ Listen to incoming messages
       â”‚   â”‚
       â”‚   â””â”€â†’ Decode JSON and emit to Stream
       â”‚       â”‚
       â”‚       â””â”€â†’ UI updates automatically via StreamBuilder
       â”‚
       â””â”€â†’ Send messages via WebSocket
           â”‚
           â””â”€â†’ Backend broadcasts to all connected clients
```

## File Structure

```
lib/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ api_config.dart           # API endpoints & configuration
â”‚   â”‚
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ api_service.dart          # Base HTTP service
â”‚       â””â”€â”€ auth_service.dart         # Authentication service
â”‚
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ shop/
â”‚   â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”‚   â”œâ”€â”€ shop_home_screen_new.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ product_listing_screen.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ product_details_screen.dart
â”‚   â”‚   â”‚   â””â”€â”€ shopping_cart_screen.dart
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚       â”œâ”€â”€ product_service.dart   # Product API calls
â”‚   â”‚       â””â”€â”€ cart_service_api.dart  # Cart API calls
â”‚   â”‚
â”‚   â””â”€â”€ messages/
â”‚       â”œâ”€â”€ screens/
â”‚       â”‚   â”œâ”€â”€ messages_screen.dart
â”‚       â”‚   â””â”€â”€ chat_screen.dart
â”‚       â”‚
â”‚       â””â”€â”€ services/
â”‚           â””â”€â”€ messages_service.dart  # Messages + WebSocket
â”‚
â””â”€â”€ main.dart
```

## API Endpoints Map

```
BASE_URL/api/

â”œâ”€â”€ /auth
â”‚   â”œâ”€â”€ POST   /login           â†’ Login user
â”‚   â”œâ”€â”€ POST   /register        â†’ Register new user
â”‚   â”œâ”€â”€ POST   /logout          â†’ Logout user
â”‚   â”œâ”€â”€ GET    /me              â†’ Get current user
â”‚   â”œâ”€â”€ POST   /refresh         â†’ Refresh auth token
â”‚   â”œâ”€â”€ POST   /forgot-password â†’ Request password reset
â”‚   â”œâ”€â”€ POST   /reset-password  â†’ Reset password
â”‚   â””â”€â”€ PUT    /change-password â†’ Change password
â”‚
â”œâ”€â”€ /products
â”‚   â”œâ”€â”€ GET    /                â†’ Get all products (with filters)
â”‚   â”œâ”€â”€ GET    /:id             â†’ Get product by ID
â”‚   â”œâ”€â”€ GET    /featured        â†’ Get featured products
â”‚   â”œâ”€â”€ GET    /categories      â†’ Get all categories
â”‚   â”œâ”€â”€ GET    /search          â†’ Search products
â”‚   â””â”€â”€ GET    /:id/similar     â†’ Get similar products
â”‚
â”œâ”€â”€ /cart
â”‚   â”œâ”€â”€ GET    /                â†’ Get user's cart
â”‚   â”œâ”€â”€ POST   /add             â†’ Add item to cart
â”‚   â”œâ”€â”€ PUT    /:itemId         â†’ Update item quantity
â”‚   â”œâ”€â”€ DELETE /:itemId         â†’ Remove item from cart
â”‚   â”œâ”€â”€ DELETE /clear           â†’ Clear entire cart
â”‚   â”œâ”€â”€ POST   /coupon          â†’ Apply coupon code
â”‚   â”œâ”€â”€ DELETE /coupon          â†’ Remove coupon
â”‚   â””â”€â”€ GET    /summary         â†’ Get cart summary
â”‚
â”œâ”€â”€ /messages
â”‚   â”œâ”€â”€ GET    /                â†’ Get all conversations
â”‚   â”œâ”€â”€ GET    /:id/messages    â†’ Get messages for conversation
â”‚   â”œâ”€â”€ POST   /:id/send        â†’ Send message
â”‚   â”œâ”€â”€ PUT    /:id/read        â†’ Mark message as read
â”‚   â”œâ”€â”€ PUT    /:id/mark-read   â†’ Mark conversation as read
â”‚   â”œâ”€â”€ DELETE /:id             â†’ Delete message
â”‚   â”œâ”€â”€ POST   /                â†’ Create new conversation
â”‚   â”œâ”€â”€ GET    /unread-count    â†’ Get unread messages count
â”‚   â””â”€â”€ GET    /search          â†’ Search conversations
â”‚
â””â”€â”€ WebSocket: wss://backend-url?token=xyz
    â”œâ”€â”€ type: 'message'         â†’ New message
    â”œâ”€â”€ type: 'typing'          â†’ User typing
    â”œâ”€â”€ type: 'read'            â†’ Message read
    â””â”€â”€ type: 'status'          â†’ User online/offline
```

## Authentication Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  App Start  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â†’ ApiService.init()
       â”‚   â”‚
       â”‚   â””â”€â†’ Load token from SharedPreferences
       â”‚
       â”œâ”€â†’ Token exists?
       â”‚   â”‚
       â”‚   â”œâ”€â†’ YES: Navigate to Home Screen
       â”‚   â”‚         (Token included in all requests)
       â”‚   â”‚
       â”‚   â””â”€â†’ NO: Navigate to Login Screen
       â”‚
       â””â”€â†’ User logs in
           â”‚
           â”œâ”€â†’ AuthService.login(email, password)
           â”‚   â”‚
           â”‚   â””â”€â†’ Backend validates credentials
           â”‚       â”‚
           â”‚       â””â”€â†’ Returns JWT token + user data
           â”‚           â”‚
           â”‚           â””â”€â†’ ApiService.saveToken(token)
           â”‚               â”‚
           â”‚               â””â”€â†’ Save to SharedPreferences
           â”‚
           â””â”€â†’ Navigate to Home Screen
               â”‚
               â””â”€â†’ All API calls include token automatically
```

## Error Handling Flow

```
API Request
   â”‚
   â””â”€â†’ try {
       â”‚
       â”œâ”€â†’ await service.method()
       â”‚
       â””â”€â†’ Success: Update UI with data
       }
   â”‚
   â””â”€â†’ catch (e) {
       â”‚
       â”œâ”€â†’ e is ApiException?
       â”‚   â”‚
       â”‚   â”œâ”€â†’ statusCode == 401: Token expired
       â”‚   â”‚   â”‚
       â”‚   â”‚   â””â”€â†’ Try refreshToken()
       â”‚   â”‚       â”‚
       â”‚   â”‚       â”œâ”€â†’ Success: Retry original request
       â”‚   â”‚       â”‚
       â”‚   â”‚       â””â”€â†’ Fail: Navigate to Login
       â”‚   â”‚
       â”‚   â”œâ”€â†’ statusCode == 404: Resource not found
       â”‚   â”‚   â”‚
       â”‚   â”‚   â””â”€â†’ Show "Not found" message
       â”‚   â”‚
       â”‚   â””â”€â†’ Other errors: Show error message
       â”‚
       â””â”€â†’ Network error: Show "Check connection" message
       }
```

## State Management (Future Enhancement)

For better state management, consider using Provider/Riverpod:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Providers                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ AuthProvider â”‚  â”‚ CartProvider â”‚  â”‚   Product  â”‚ â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚  Provider  â”‚ â”‚
â”‚  â”‚ â€¢ user       â”‚  â”‚ â€¢ items      â”‚  â”‚            â”‚ â”‚
â”‚  â”‚ â€¢ token      â”‚  â”‚ â€¢ total      â”‚  â”‚ â€¢ products â”‚ â”‚
â”‚  â”‚ â€¢ isAuth     â”‚  â”‚ â€¢ count      â”‚  â”‚ â€¢ loading  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Notifies
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UI Widgets                          â”‚
â”‚  â€¢ Automatically rebuild when provider data changes   â”‚
â”‚  â€¢ Access data via context.watch<Provider>()          â”‚
â”‚  â€¢ Call methods via context.read<Provider>()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Summary

âœ… **Complete backend integration infrastructure**
âœ… **Authentication with token management**
âœ… **RESTful API services for all features**
âœ… **Real-time messaging with WebSocket**
âœ… **Error handling and recovery**
âœ… **Ready to connect to your MongoDB backend**

**Next: Update backend URL in `api_config.dart` and start connecting screens!**
